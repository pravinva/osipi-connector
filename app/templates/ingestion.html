<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="/static/css/pi_style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <link rel="icon" type="image/x-icon" href="/static/images/favicon.ico">
</head>
<body>
    <header class="pi-header">
        <div class="container">
            <div class="logo-section">
                <img src="/static/images/aveva_logo.png" alt="AVEVA Logo" class="aveva-logo">
                <h1>PI Lakehouse Ingestion Dashboard</h1>
            </div>
            <div class="nav-links">
                <a href="/" class="nav-link">Home</a>
                <a href="/docs" class="nav-link">API Docs</a>
                <a href="/piwebapi" class="nav-link">PI Web API</a>
            </div>
        </div>
    </header>

    <main class="container dashboard">
        <!-- Quick Links to Workspace -->
        <section class="quick-links-bar">
            <a href="https://e2-demo-field-eng.cloud.databricks.com/explore/data/osipi/bronze/pi_timeseries" class="quick-link" target="_blank">
                <span class="link-icon">üìä</span>
                <span class="link-text">Bronze Table</span>
            </a>
            <a href="https://e2-demo-field-eng.cloud.databricks.com/explore/data/osipi/gold/pi_metrics_hourly" class="quick-link" target="_blank">
                <span class="link-icon">‚ú®</span>
                <span class="link-text">Gold Table</span>
            </a>
            <a href="https://e2-demo-field-eng.cloud.databricks.com/#workspace/Users/pravin.varma@databricks.com/OSIPI_Lakeflow_Connector" class="quick-link" target="_blank">
                <span class="link-icon">üìì</span>
                <span class="link-text">Connector Notebook</span>
            </a>
            <a href="https://e2-demo-field-eng.cloud.databricks.com/#job/list" class="quick-link" target="_blank">
                <span class="link-icon">‚öôÔ∏è</span>
                <span class="link-text">Workflows</span>
            </a>
        </section>

        <!-- Status KPIs -->
        <section class="kpi-grid">
            <a href="https://e2-demo-field-eng.cloud.databricks.com/explore/data/osipi/bronze/pi_timeseries" class="kpi-card kpi-card-link status" target="_blank">
                <div class="kpi-content">
                    <div class="kpi-label">Bronze Timeseries</div>
                    <div class="kpi-value" id="rows_last_hour">--</div>
                    <div class="kpi-subtitle">rows ingested</div>
                </div>
            </a>

            <a href="https://e2-demo-field-eng.cloud.databricks.com/explore/data/osipi/bronze/pi_timeseries" class="kpi-card kpi-card-link" target="_blank">
                <div class="kpi-content">
                    <div class="kpi-label">Active Tags</div>
                    <div class="kpi-value" id="tags_ingested">--</div>
                    <div class="kpi-subtitle">tags monitored</div>
                </div>
            </a>

            <a href="https://e2-demo-field-eng.cloud.databricks.com/explore/data/osipi/gold/pi_metrics_hourly" class="kpi-card kpi-card-link" target="_blank">
                <div class="kpi-content">
                    <div class="kpi-label">Gold Metrics</div>
                    <div class="kpi-value" id="quality_score">--</div>
                    <div class="kpi-subtitle">% quality</div>
                </div>
            </a>

            <a href="https://e2-demo-field-eng.cloud.databricks.com/#workspace/Users/pravin.varma@databricks.com/OSIPI_Lakeflow_Connector" class="kpi-card kpi-card-link" target="_blank">
                <div class="kpi-content">
                    <div class="kpi-label">Connector Status</div>
                    <div class="kpi-value" id="status">Loading...</div>
                    <div class="kpi-subtitle">last run: <span id="last_run">--</span></div>
                </div>
            </a>
        </section>

        <!-- Charts -->
        <section class="chart-grid">
            <div class="chart-card">
                <div class="chart-header">
                    <h3>Ingestion Rate (Last Hour)</h3>
                    <a href="https://e2-demo-field-eng.cloud.databricks.com/explore/data/osipi/gold/pi_metrics_hourly" class="chart-link" target="_blank">View in Catalog ‚Üí</a>
                </div>
                <canvas id="rowsChart"></canvas>
            </div>

            <div class="chart-card">
                <div class="chart-header">
                    <h3>Tags by Sensor Type</h3>
                    <a href="https://e2-demo-field-eng.cloud.databricks.com/explore/data/osipi/bronze/pi_timeseries" class="chart-link" target="_blank">View in Catalog ‚Üí</a>
                </div>
                <canvas id="tagsChart"></canvas>
            </div>
        </section>

        <!-- Pipeline Health -->
        <section class="pipeline-section">
            <h3>Pipeline Health</h3>
            <div id="pipeline_health" class="pipeline-grid">
                <!-- Populated by JavaScript -->
            </div>
        </section>

        <!-- Recent Events -->
        <section class="events-section">
            <h3>Recent Events</h3>
            <div id="recent_events" class="events-list">
                <!-- Populated by JavaScript -->
            </div>
        </section>
    </main>

    <footer class="pi-footer">
        <div class="container">
            <div class="footer-bottom">
                <p>PI Lakehouse Ingestion Dashboard | Data refreshes every 30 seconds</p>
            </div>
        </div>
    </footer>

    <script src="/static/js/dashboard.js"></script>
</body>
</html>
